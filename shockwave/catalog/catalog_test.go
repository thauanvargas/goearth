package catalog

import (
	"encoding/hex"
	"testing"

	g "xabbo.b7c.io/goearth"
)

var catalogIndexHex = `636174616c6f672e706167652e66726f6e745f706167650946726f6e7420506167650d636174616c6f672e706167652e6c65676163795f7261726509526172650d636174616c6f672e706167652e6c65676163795f73706f7274730953706f7274730d636174616c6f672e706167652e6c65676163795f737061636573095370616365730d636174616c6f672e706167652e62635f6172656109417265610d636174616c6f672e706167652e6c65676163795f63616e64790943616e64790d636174616c6f672e706167652e6c65676163795f6963656409496365640d636174616c6f672e706167652e7365745f6c6f646765094c6f6467650d636174616c6f672e706167652e7365745f6d6f6465094d6f64650d636174616c6f672e706167652e6c65676163795f706c617374696309506c6173746f0d636174616c6f672e706167652e6c65676163795f7075726109507572610d636174616c6f672e706167652e6c65676163795f62617468726f6f6d0942617468726f6f6d0d636174616c6f672e706167652e6c65676163795f706c616e747309506c616e74730d636174616c6f672e706167652e6c65676163795f7275677309527567730d636174616c6f672e706167652e6c65676163795f706574735f707572636861736509506574730d636174616c6f672e706167652e6c65676163795f7065745f6163636573736f7269657309506574204163636573736f726965730d636174616c6f672e706167652e6c65676163795f63616d6572610943616d6572610d636174616c6f672e706167652e6c65676163795f63616d657261320943616d657261320d636174616c6f672e706167652e726f6c6c65727309486162626f20526f6c6c6572730d636174616c6f672e706167652e74656c65706f72740954656c65706f72740d636174616c6f672e706167652e6c65676163795f74726f70686965730954726f70686965730d636174616c6f672e706167652e6c65676163795f6163636573736f72696573094163636573736f726965730d636174616c6f672e706167652e67616c6c6572790947616c6c6572790d636174616c6f672e706167652e6c65676163795f666c61677309466c6167730d636174616c6f672e706167652e6c65676163795f6465616c73094465616c730d636174616c6f672e706167652e6c65676163795f70726573656e74730950726573656e74730d`

var catalogPageHex = `693a7365745f6d6f64650d6e3a7365745f6d6f64650d0d6c3a63746c675f6c61796f7574320d673a636174616c6f675f6d6f64655f686561646c696e65310d0d683a537465656c792066756e6374696f6e616c69747920636f6d62696e6564207769746820736c65656b2064657369676e6572207570686f6c73746572792e2054686520486162626f2077686f2063686f6f7365732074686973206675726e6974757265206973206120636f6f6c20757262616e20636174202d20737472656574776973652c20736173737920616e6420736f20736c696768746c7920756e746f75636861626c652e0d0d773a436c69636b206f6e20616e206974656d20746f20736565206d6f72652064657461696c730d0d653a636174616c6f675f6d6f64655f746561736572312c2c0d733a313a323a204f6f6f682c20736f207368696e7920616e64206e6577210d0d0d703a446f75626c6520426564094769766520796f757273656c6620737061636520746f2073747265746368206f75740934090973096265645f706f6c79666f6e093009322c330941322053325009236666666666662c236666666666662c234142443044322c234142443044320d703a53696e676c652042656409436f74206f66207468652061727469737469630933090973096265645f706f6c79666f6e5f6f6e65093009312c330941312053315009236666666666662c236666666666662c236666666666662c234142443044322c234142443044320d703a46697265706c61636509436f6d666f727420696e20737461696e6c65737320737465656c09350909730966697265706c6163655f706f6c79666f6e093209322c310941322054415009234646464646462c234646464646462c234646464646460d703a54776f2d73656174657220536f666109436f6d666f727420666f72207374796c69736820636f75706c6573093409097309736f66615f706f6c79666f6e093009322c310941322053485009236666666666662c236666666666662c236666666666662c236666666666662c234142443044322c234142443044322c234142443044322c234142443044320d703a41726d6368616972094c6f66742d7374796c6520636f6d666f7274093309097309736f666163686169725f706f6c79666f6e093009312c310941312053545009236666666666662c236666666666662c234142443044322c234142443044320d703a4d696e692d42617209596f75206e61756768747920486162626f210935090973096261725f706f6c79666f6e093209312c3109413220424150090d703a486174636820284c6f636b61626c652909416c6c20626172732073686f756c642068617665206f6e65093609097309646976696465725f706f6c7933093009312c3109613220706f6c796f766909234646464646462c234646464646462c234646464646462c234142443044322c234142443044320d703a4261722f6465736b095065726665637420666f7220776f726b206f7220706c61790933090973096261726465736b5f706f6c79666f6e093009322c310941312042545009236666666666662c236666666666662c234142443044322c234142443044320d703a436f726e657220436162696e65742f4465736b095475636b20697420617761790933090973096261726465736b636f726e65725f706f6c79666f6e093009312c3109413120424b5009236666666666662c234142443044320d703a44696e696e67204368616972094d6574616c6c69632073656174696e6720657870657269656e636509330909730963686169725f706f6c79666f6e093009312c310941312054555009302c302c300d703a4c617267652044696e696e67205461626c6509466f72206c617267657220676174686572696e6773093409097309736d6f6f74685f7461626c655f706f6c79666f6e093009322c3209413220523250090d703a4c61726765205461626c6509456e6a6f79206120637570206f66206a6f652061742074686973207461626c65210933090973097461626c655f706f6c79666f6e093009322c3209413220525050090d703a4c6172676520436f66666565205461626c6509466f72206c617267657220676174686572696e67730933090973097461626c655f706f6c79666f6e5f6d6564093009322c3209413120504d5009302c302c300d703a536d616c6c20436f66666565205461626c6509466f722073657276696e672061207374796c697368206c617474650931090973097461626c655f706f6c79666f6e5f736d616c6c093009322c320941312050505009302c302c300d703a426f6f6b6361736509466f72207468652061727479207061640934090973097368656c7665735f706f6c79666f6e093009322c31094132204b485009302c302c300d703a5368656c6609546964792075700931090973097374616e645f706f6c79666f6e5f7a093009312c31094131204c545009302c302c30`

func TestCatalogIndex(t *testing.T) {
	bytes, err := hex.DecodeString(catalogIndexHex)
	if err != nil {
		t.Fatal(err)
	}

	pkt := g.Packet{
		Client: g.Shockwave,
		Header: g.Header{Dir: g.In},
		Data:   bytes,
	}

	var index Index
	pkt.Read(&index)

	t.Log(index)
}

func TestCatalogPage(t *testing.T) {
	bytes, err := hex.DecodeString(catalogPageHex)
	if err != nil {
		t.Fatal(err)
	}

	pkt := g.Packet{
		Client: g.Shockwave,
		Header: g.Header{Dir: g.In},
		Data:   bytes,
	}

	var page Page
	pkt.Read(&page)

	t.Log(page)
}
